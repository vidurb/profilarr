services:
    frontend:
        image: node:18
        working_dir: /app
        command: sh -c "npm install && npm run dev -- --host 0.0.0.0"
        ports:
            - '3000:3000'
        volumes:
            - ./frontend:/app
            # Use a named volume or anonymous volume for node_modules to persist it 
            # and prevent host overwriting if local node_modules is missing/different
            - /app/node_modules
        environment:
            - CHOKIDAR_USEPOLLING=true

    backend:
        build: 
            context: .
            dockerfile: Dockerfile
            target: development
        ports:
            - '5000:5000'
        volumes:
            - ./backend:/app
            - ./config:/config
        environment:
            - TZ=Australia/Adelaide
            - FLASK_ENV=development
            - FLASK_DEBUG=1
        restart: always
